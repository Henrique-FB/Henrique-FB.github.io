<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dwarf Fortress Server Tutorial</title>
  <link rel="stylesheet" href="/assets/styles/project-page-style.css">
  <link rel="stylesheet" href="/assets/styles/sidebar-style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
            <nav>
        
        <h1>Henry</h1>
    <ul>
      <li>
        <a href="../index.html">
          <!-- Example icon: document-text -->
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="icon">
          <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
          </svg>
          <span class="label">CV</span>
        </a>
      </li>

      <li>
          <hr class="sidebar-separator" />
    </li>

      <li>
        <a href="../pages/projects.html">
          <!-- Example icon: folder -->
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="icon">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 0 0-1.883 2.542l.857 6a2.25 2.25 0 0 0 2.227 1.932H19.05a2.25 2.25 0 0 0 2.227-1.932l.857-6a2.25 2.25 0 0 0-1.883-2.542m-16.5 0V6A2.25 2.25 0 0 1 6 3.75h3.879a1.5 1.5 0 0 1 1.06.44l2.122 2.12a1.5 1.5 0 0 0 1.06.44H18A2.25 2.25 0 0 1 20.25 9v.776" />
          </svg>
          <span class="label">Projetos</span>
        </a>
      </li>

    </ul>
  </nav>

    </aside>
    <main class="content">
      <p class="emphasized">2024-12-09</p>

      <div class="project-page">
        <h1 id="dwarf-fortress-server">Dwarf Fortress Server</h1>

<p class="emphasized">If you are here just to have a quick sniff around my portfolio, I recommend only reading sections with this bookmark on the title üìö. They are more concise, to the point and have less creative writing mixed in. Likely what you are looking for.</p>

<h1 id="introduction">Introduction</h1>

<p>So, after setting up a Proxmox virtual machine, learning how to use it and having some fun with setting up an ARR stack in it, I was stricken with a big craving to play <a href="http://www.bay12games.com/dwarves/?">Dwarf Fortress</a> (or, DF in short).</p>

<p>Since I was very excited about having set up a (albeit extremely small) homelab, I thought ‚Äúwhy not make it a server that runs on my machine?‚Äù.</p>

<p>‚ÄúBecause Dwarf Fortress isn‚Äôt multiplayer, silly.‚Äù You might say, and you would be right! But I did it anyway.</p>

<h2 id="-project-overview">üìö Project Overview</h2>

<p>Dwarf Fortress is a computer fantasy simulation game. Setting it up as a server allows not only for multiplayer play (using the <strong>DFHack</strong> and <strong>DFPlex</strong> plugins), but also for safe access anywhere (using the <strong>ZeroTier</strong> networking virtualization platform), simple and easy to setup game backups, and much more.</p>

<p>This project demonstrates skills in</p>

<ul>
  <li><strong>Linux system administration</strong> (mainly Linux CLI),</li>
  <li><strong>Virtualization</strong> (setting up the server on Proxmox, setting up the networks in ZeroTier, and showcasing the many ways I failed horribly before actually getting it to work)</li>
  <li><strong>Programming</strong> very small <strong>Lua</strong> scripts (with barely any knowledge of lua beforehand)</li>
  <li>Usage of obscure software tricks and an ability to work with what I‚Äôve got.</li>
</ul>

<p class="emphasized"> ~Edit: I don't have time to edit this project right now, but almost a year later I came back to it and set a world-wide server for me and some friends to play in. If you trust me enough to believe this, the project technically also demonstrates skills in using OCI (Oracle Cloud Infrastructure, where I set the server up) and nginx (to manage access to my server).</p>

<h2 id="-technologies-used">üìö Technologies Used</h2>

<ul>
  <li><strong>Proxmox</strong> (Virtualization environment): I generally have every one of my server instances set up as Linux Containers inside it, they are very resource efficient so even with the 6GB of RAM my server has everything works pretty well</li>
  <li>Linux (and some random libraries): Operating system for the server</li>
  <li>Lua: for a very small script I made.</li>
</ul>

<hr />
<h2 id="dfplex---multiplayer-df">DFPlex - Multiplayer DF</h2>

<p>If you don‚Äôt already know, there is a multiplayer plugin for DF called <a href="https://github.com/white-rabbit-dfplex/dfplex">DFPlex</a> that allows you to run it as a server, and people can connect to it over a web interface. Highly recommend trying it (as playing DF with multiple people who have absolutely no clue what they are doing is even more fun than with just one person who has no clue what they are doing) - It is what I used to make this whole thing work.</p>

<h2 id="proxmox-and-containers">Proxmox and Containers</h2>

<p>Proxmox is a virtualization tool I use to run my home server in, and I generally use Linux Containers (LXCs) to set up my servers. If you have absolutely no idea what these are, you can very easily ignore the sections where I talk about them, taking only the knowledge that I‚Äôm running all of this on a headless Ubuntu server (so, a linux OS without any screens attached to it), and controlling it over a command line accessible through the Proxmox web Graphical Interface (WebGUI).</p>

<hr />
<h1 id="setup-process">Setup Process</h1>

<h2 id="1-proxmox-configuration">1. Proxmox Configuration</h2>

<p>~ I won‚Äôt be detailing all the steps to set up proxmox in here. Maybe in another project.</p>

<hr />
<h2 id="2-linux-installation">2. Linux Installation</h2>

<p>I created a simple Ubuntu LXC (Linux Container) mostly because I‚Äôm more familiar with Ubuntu, and there was no need to create a whole Virtual Machine to run this server in (I ended up doing it anyway for debugging purposes.)</p>

<p>Simply boot up a linux template on proxmox (you can install a bunch in <a href="https://pve.proxmox.com/wiki/Linux_Container">various different ways</a>) and you are good to go.</p>

<p>LXC info:</p>
<ul>
  <li>Reasonably sure using only 1 CPU core is enough as from what I‚Äôve read DF can‚Äôt make use of more than 1 anyway.</li>
  <li>1 gig of RAM is also likely enough as DFs the bottleneck tends to be CPU.</li>
  <li>I can‚Äôt see a DF server needing more than 10G of disk space.</li>
</ul>

<hr />
<h2 id="3-dwarf-fortress-server-installation">3. Dwarf Fortress Server Installation</h2>

<p>The beginning of this process is extremely simple.</p>

<p>To run DFPlex, you need to have Dwarf Fortress, DFHack (a Dwarf Fortress plugin) and DFPlex (another Dwarf Fortress plugin) all set up. To do so you‚Äôd download each of these and drag them all into the same folder (DF -&gt; DFHack -&gt; DFPlex and merging files accordingly).</p>

<p>After some googling about Dwarf Fortress versions (and if on linux, after a lot of command-line magic using wgets, tars, zips and copies) you should have your game good to go.</p>

<p>‚Ä¶</p>

<p>Or so I believed. And that would be the case, if I was running this on a normal machine, with normal specs, a normal setup, etc - And I even did so beforehand on my machine and everything worked out perfectly (works on my machine :P) - But I‚Äôm not, and so we aren‚Äôt quite done yet.</p>

<h3 id="31-the-first-problem">3.1 The First Problem</h3>

<p>Two problems were still left to be solved.</p>

<p>The first of them (and one I already expected I‚Äôd have), was the fact that I had no screen.</p>

<p>The game doesn‚Äôt run without one, and it even is so friendly as to tell you so with a  <code class="language-plaintext highlighter-rouge">2d mode "Display not found"</code> error.  This would probably lead any sane individual into searching the problem on google, and finding out that there indeed is a ‚ÄúTEXT‚Äù mode you can turn on, but after trying to enable it, I got a stupid amount of dependecy errors (which I tried to solve for about an hour before deciding against it).</p>

<p>Its also worth noting that DFPlex runs the clients on 2D mode over a Web GUI, and I was not interested in trying to set up TEXT mode for hours only to learn that DFPlex required 2D mode anyway - So after a while I ultimately decided to try a different, more interesting method.</p>

<p>Since DF really wants to have a display to run on 2d mode, why don‚Äôt we give it one? Not a real display, of course, but DF doesn‚Äôt understand the difference between a <em>real</em> display and an emulated display, so that should work out fine - Also the server clients run on a WebGUI over my network so I as a person don‚Äôt <em>actually</em> need to see the DF display, I‚Äôll do so on my own computer over the server client.</p>

<p><em>puts on sysadmin glasses</em>
<em>fails to find a way to do it multiple times, cries, finally finds it</em></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export DISPLAY:=1 
Xvfb :1 -screen 0 1024x768x24 &amp;
</code></pre></div></div>

<p>This is what I ended up going with. Emulates a screen and so now Dwarf Fortress should run without error, except‚Ä¶</p>

<p>I got a bunch of dependency errors again. . . Which is nice! Cause now I know exactly what to do. Install dependencies. For about 2 hours. 
I ended up finding <a href="https://askubuntu.com/questions/226613/how-do-i-install-the-library-libsdl-image-1-2-so-0-required-to-run-dwarf-fortres">the last answer on this page</a> which ended up working out.</p>

<p>Trying to run DF again, I get a warning that the game wouldn‚Äôt be able to display sound (which makes sense, I didn‚Äôt have any sound output and also didn‚Äôt bother emulating any), and it works!</p>

<p>Or it says it does‚Ä¶ but when I try to enter the ip and port to access the WebGUI on my Firefox (chrome and other browsers apparently don‚Äôt work btw) it.. still doesn‚Äôt work.</p>

<p>And so we head on to</p>

<h3 id="32-the-other-problem">3.2 The Other Problem</h3>

<p>I was completely stumped.</p>

<p>searched about it for hours, re-traced my steps, tried TEXT mode again (which was a mistake.), and went onto the ultimate measure.</p>

<p>I created another container in Proxmox (this time an actual Virtual Machine, with all the good stuff a VM has like an actual graphical display) and set it up all over again. I‚Äôm not the best Linux CLI user so maybe there was <em>something</em> I was missing, and having a graphical interface to look through it might help me.</p>

<p>After some more hours waiting for the machine to boot, libraries to get installed, dependencies, and all the good stuff I‚Äôve already detailed this far, I was finally able to load up the game.</p>

<p>Loaded up perfectly, just like on my LXC container, but when I was about to play the game, I noticed that before I could actually do that, I <strong>needed</strong> to click ‚ÄúOK‚Äù on a popup with the same warning I had seen (through text on the command line) before. That the game wouldn‚Äôt be able to display any sound.</p>

<p>Once I clicked OK, everything worked. Could even connect to it over the web interface. 
The popup on my headless LXC appeared on my <em>emulated</em> screen, so I couldn‚Äôt ever see it, but for the game to actually boot up properly I <strong>had</strong> to click on said popup.</p>

<p>So I spent some hours solving a problem that, in hindsight, has one of the easiest fixes possible. Just go into the game‚Äôs init.cfg file (where there are configurations like the 2D or TEXT mode I mentioned earlier) and tell it to run without sound (change SOUND:YES to SOUND:NO). 
If I had disabled sound beforehand I wouldn‚Äôt have known this problem had the slight possibility of even existing in the first place.</p>

<p>either way, now with deactivated sound back on my LXC container, I booted up the server (running the dfhack file) and it worked like a charm.</p>

<p><img src="../assets/images/DFPlex_Client.png" alt="DFPlex Client.png" /></p>

<h3 id="33-in-summary">3.3üìö In Summary,</h3>
<p>The steps I took on the server installation process were:</p>
<ul>
  <li>Install DF, DFHack and DFPlex and merge them all in one folder (using Linux CLI tools like <code class="language-plaintext highlighter-rouge">wget</code>, <code class="language-plaintext highlighter-rouge">cp</code>, <code class="language-plaintext highlighter-rouge">tar</code>, <code class="language-plaintext highlighter-rouge">zip</code> and so on)</li>
  <li>Emulate a screen on my headless Linux Container for the game to be ‚Äúdisplayed‚Äù in (using <code class="language-plaintext highlighter-rouge">Xvfb</code> and <code class="language-plaintext highlighter-rouge">export display</code>)</li>
  <li>Turn off the sounds of the game using the init.cfg file. (I know it does not sound like so, but this step is <em>required</em> for the server to function)</li>
  <li>Install all the necessary dependencies (for me, <a href="https://askubuntu.com/questions/226613/how-do-i-install-the-library-libsdl-image-1-2-so-0-required-to-run-dwarf-fortres">the last answer on this page</a> ended up working out)</li>
  <li><code class="language-plaintext highlighter-rouge">./dfhack</code> on the command line (on the df folder) and access the server‚Äôs client WebGUI using firefox (other browsers might not work)</li>
</ul>

<hr />
<h2 id="4-network-configuration">4. Network Configuration</h2>

<p>Now that we have the DFPlex server running locally, its time to have some fun with network virtualization (or, more specifically, LAN-like network extension).</p>

<p>If you have ever tried your hand at opening any game server you have like either</p>
<ol>
  <li>Used Hamachi or</li>
  <li>Forwarded a port on your router</li>
</ol>

<p>On this project I used‚Ä¶ neither.</p>
<h3 id="41-the-obvious-ways-to-do-it-port-forwarding-or-hamachi">4.1 The obvious ways to do it (Port Forwarding or Hamachi)</h3>

<p>The specific reason why I didn‚Äôt want to forward a port for this is pretty simple. The application that runs my server (DFPlex) is neither built with network safety in mind, nor maintained, and it gives <em>anyone</em> in my network access to my server. This is, as far as I understand, as insecure as connections get, and because I didn‚Äôt want Soka_The_Network_Bender to show up on my server and do some <em>weird stuff</em> ‚Ñ¢ to my machine, I quickly decided against it.</p>

<p>The reason for not using hamachi is surprisingly even more simple.
Although I actually did want to use it (especially because I had done so on my windows computer when first testing DFPlex and it worked flawlessly), I could not for the life of me get it to work on my container. There isn‚Äôt much more to say, I tried everything I could find on it and it completely refused to work, and so I went in search for other options.</p>

<h3 id="42-the-not-so-obvious-ways-to-do-it-tailscale-or-zerotier">4.2 The not so obvious ways to do it (Tailscale or ZeroTier)</h3>

<p>The first other option that came to mind was using Tailscale, another very similar software, and one I was already using to access proxmox on other machines I have (like my cellphone for example) from outside my home.</p>

<p>I thought it was going to be very easy. Just set up a way for other people to join my Tailscale group and advertise my ip (basically <em>exactly</em> what I do to remote access proxmox itself), edit the config file to allow them to access the advertised ips and voila, done. How hard can that be?</p>

<p>After some hours trying to make it work I found out that, turns out, it is literally impossible.</p>

<p>Apparently Tailscale only allows access from machines that are connected to your own Tailscale account, and since my account was connected to my e-mail, I wasn‚Äôt really looking forward to sharing my passwords with the half dozen people I wanted to play Dwarf Fortress with.</p>

<p>The next thing I tried was ZeroTier. It is basically the same as Hamachi, with the slight difference that you log into your account and manage the servers using a web interface. 
After having done that, all I needed to do was install ZeroTier on my LXC (find a <a href="https://www.reddit.com/r/Proxmox/comments/jctd6x/comment/ge9n5m1/?utm_source=share&amp;utm_medium=web3x&amp;utm_name=web3xcss&amp;utm_term=1&amp;utm_content=share_button">random dude</a> on reddit telling me that I needed to change one specific line of one specific proxmox config file), connect to my network, tell everyone else to connect to said network, accept all the connections and done deal. Server working completely flawlessly (except for all the flaws it had. Don‚Äôt worry I‚Äôll get to them).</p>

<p><img src="../assets/images/ZeroTier_Manager.png" alt="ZeroTier Manager.png" /></p>
<h3 id="43-in-summary">4.3üìö In Summary,</h3>
<p>The steps in the network configuration process were:</p>
<ul>
  <li><em>Not</em> port forward (for security reasons)</li>
  <li>Install and configure ZeroTier (<a href="https://www.reddit.com/r/Proxmox/comments/jctd6x/comment/ge9n5m1/?utm_source=share&amp;utm_medium=web3x&amp;utm_name=web3xcss&amp;utm_term=1&amp;utm_content=share_button">This comment</a> was especially helpful)</li>
  <li>Set up ZeroTier network (and manage it trough their web interface) and connect all machines that will be using the server to it</li>
</ul>

<hr />

<h2 id="5-server-management-and-maintenance">5. Server Management and Maintenance</h2>

<p>After setting up the whole thing, I played it with some folks for a couple of hours, and it was generally great.</p>

<p>There were still some things I wanted to do to call this project a success:</p>
<ul>
  <li>Find a way to save the game</li>
  <li>Let the players go into the game‚Äôs main menu</li>
  <li>Make the game pause when no one was in the server</li>
</ul>

<h3 id="51-saving-game-and-main-menu">5.1 Saving Game and Main Menu</h3>

<p>For anyone who has played DF before, it might sound weird not being able to save the game. Usually, you simply press ESC and the option to do it pops on your screen. That, needless to say, is not the case when you are running a server.</p>

<p>For reasons I couldn‚Äôt quite figure out, the menu is inaccessible through the clients (the people actually playing the game), and since I didn‚Äôt really have a display to see the server‚Äôs interface of the game, I couldn‚Äôt even access the menu myself.</p>

<p>This lead me into searching a bit about DFHack‚Äôs <strong>scripts</strong>. When you run the server through <code class="language-plaintext highlighter-rouge">./dfhack</code> (what I was doing) the terminal basically becomes a DFHack command line, in which you can run a multitude of plugins and commands. Coincidentally, there is a <code class="language-plaintext highlighter-rouge">quicksave</code> command, so lucky me.</p>

<p>Next step now was making the menu accessible to the players,. After figuring out the quicksave command I expected this to be easy, but it was a big disappointment. My guess is DFPlex‚Äôs client side simply doesn‚Äôt have the capability of accessing the menu screen (also called <strong>Leavescreen</strong> on the game files), as any attempt to actually get to it via other means would either 1. not work or 2. just crash the whole server. After about an hour of search I called it and just gave up on it.</p>

<h3 id="52-pause-lua-script">5.2 Pause Lua script</h3>

<p>Pausing the game is an extremely important part of Dwarf Fortress, especially when running it as a server. If the game continues running when no one is playing your fortress is very likely to crumble even after just a day of leaving the Dwarves to do their thing.</p>

<p>I didn‚Äôt exactly know how I would do this, but in my head it was very likely going to be a DFHack script, and so I went in search of two main things:</p>
<ul>
  <li>An example of a DFHack script</li>
  <li>How I to access DFPlex‚Äôs info (for example, number of players)</li>
</ul>

<p>Turns out I was in luck as after just a bit of time searching up on the Dwarf Fortress community forums I found someone linking a DFPlex github file with both an example of a DFHack script <em>and</em> the different functions to access DFPlex‚Äôs information on said script.</p>

<p>After reading the example script, I could get a pretty good idea of how everything worked, and even though I had almost never worked with Lua before, that (and ChatGPT incredibly actually managing to give me an idea on how to use some other DFHack script functions) was enough for me to come up with this beauty:
<code class="language-plaintext highlighter-rouge">check_clients.lua</code></p>
<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">utils</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">'utils'</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">repeatUtil</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">'repeat-util'</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">dfplex</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">'plugins.dfplex'</span><span class="p">)</span>


<span class="c1">-- Function to check the number of connected clients</span>
<span class="kd">local</span> <span class="n">check_clients</span> <span class="o">=</span> <span class="k">function</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">client_count</span> <span class="o">=</span> <span class="n">dfplex</span><span class="p">.</span><span class="n">get_client_count</span><span class="p">()</span>

    <span class="c1">-- Print the current number of players</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Current number of connected players: "</span> <span class="o">..</span> <span class="n">client_count</span><span class="p">)</span>

    <span class="c1">-- Add behavior based on player count</span>
    <span class="k">if</span> <span class="n">client_count</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No players connected. Game Paused."</span><span class="p">)</span>
        <span class="n">df</span><span class="p">.</span><span class="n">global</span><span class="p">.</span><span class="n">pause_state</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="k">else</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Players are connected. Game continues."</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="c1">-- Set up a repeating task to check the client count every 30 seconds (1800 ticks)</span>

<span class="n">check_clients</span><span class="p">()</span>
</code></pre></div></div>

<p>with this script and some DFHack command line magic
<code class="language-plaintext highlighter-rouge">repeat -name check_clients_repeat -time 1800 -timeUnits ticks -command [ check_clients ]'</code></p>

<p>I was able to get the script to run every 1800 ticks (way DF counts time when game is running, about 30 sconds) and the game would pause as soon as it detected that there were no players in the game.</p>

<p>As a quick explanation,
Code:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">require()</code> gets me the functions I‚Äôd need</li>
  <li><code class="language-plaintext highlighter-rouge">dfplex.get_client_count()</code> returns the number of players connected</li>
  <li><code class="language-plaintext highlighter-rouge">df.global.pause_state = true</code> pauses the game
Command line:</li>
  <li><code class="language-plaintext highlighter-rouge">repeat</code> is the DFHack command to repeat a command</li>
  <li><code class="language-plaintext highlighter-rouge">-time 1800</code> and <code class="language-plaintext highlighter-rouge">-timeUnits ticks</code> set the time and the way said time is counted (seconds, ticks, etc)</li>
  <li><code class="language-plaintext highlighter-rouge">-command [ check_clients ]</code> calls the check_clients.lua script when the ‚Äúrepeat‚Äù script‚Äôs time runs out.</li>
</ul>

<h3 id="53-realization-and-how-you-should-test-things">5.3 Realization (and how you should test things)</h3>

<p>Now, everything was working as I wanted, but there was one small thing bugging me.</p>

<p>Even though the game <em>was</em> pausing when no players were connected, for some reason it didn‚Äôt print the message I wanted before pausing the game. If you go read the Lua script I made, it pretty clearly prints ‚ÄúNo players connected. Game Paused.‚Äù before actually pausing the game, and although I‚Äôm not <em>that</em> into fixing things that aren‚Äôt broken, this was worrying me,</p>

<p>It should be a <em>very</em> simple task, and the game <em>was</em> pausing, so why was the print not working? Was I doing something wrong?</p>

<p>Apparently, yes. Everything.</p>

<p>Now, to explain how the <code class="language-plaintext highlighter-rouge">repeat</code> command works in DFHack, you must understand what <em>ticks</em> are.
When you are playing the game, every frame is considered a tick. The game limits 100 frames per second, so every second should be equivalent to at maximum 100 ticks.</p>

<p>The thing is, when the game is paused, it is stuck in a single frame - so it stops counting ticks, as no frames are being played.</p>

<p>When you call a <code class="language-plaintext highlighter-rouge">repeat</code> command to run every, say, 1000 ticks, every 10 seconds it should run and execute the script you set up. And this <em>shouldn‚Äôt</em> be a problem for the script I devised, as when everyone left the server, it would take about 10 seconds to call the script again (since the last time it was called), notice there are no players, pause the game and pause the repeat command (as the game would be paused, so the game would count no ticks) until someone else logged in, resumed the game, and the script would resume once more.</p>

<p>The only way my script could <em>somehow</em> not print the ‚ÄúGame Paused‚Äù message and <em>still</em> pause the game, would be if the game was already being paused <em>before</em> my script ran, and it never even got to the <code class="language-plaintext highlighter-rouge">print()</code> and <code class="language-plaintext highlighter-rouge">pause_state = true</code> lines in the first place.</p>

<p>Which‚Ä¶ would make complete and total sense‚Ä¶ since as I explained before, if the server kept running once everyone was offline the dwarves would surely die in no more than a day (in our world time), and the DFPlex devs <em>obviously</em> had already thought about this.</p>

<p>So my script never got to the ‚Äúpause game‚Äù section. The game just already paused on its own when everyone left.</p>

<p>What a useless fucking tangent ay? At least it serves as a reminder that if you are going to make something, just check if its not <em>already been made</em> before. What a waste of a good few hours.</p>

<h3 id="54-in-summary">5.4üìö In Summary,</h3>
<p>The things I wanted to do regarding Server Management were:</p>
<ul>
  <li>Finding a way to save the game</li>
  <li>Automatically pausing the game when no one is logged in</li>
  <li>allowing access to the main menu for the players</li>
</ul>

<p>The solutions I uncovered were:</p>
<ul>
  <li>A <code class="language-plaintext highlighter-rouge">quicksave</code> command run on DFHack command line</li>
  <li>Creating a whole Lua script that does it for me, only to find out that the game already pauses when no clients are logged in anyway.</li>
  <li>Absolutely no way of doing it that I‚Äôve managed to find. The DFPlex client refuses to do it and goes so far as to crash the game if you try too hard.</li>
</ul>

<hr />

<h2 id="6-future-improvements">6. Future Improvements</h2>

<p>I am probably done working on this one for now, but in the future I‚Äôd definitely want to make some improvements, mainly:</p>
<ul>
  <li>Finding out a damn way to let the clients access the menu screen.</li>
  <li>Running backup schedules on Proxmox to make sure nothing will happen to the server‚Äôs saved game.</li>
  <li>Possibly wrapping the whole client in <em>another</em> WebGUI client made by myself - that way it would be much safer to not use ZeroTier for connections(allowing me to port forward without that much worry), and would allow me to make some very useful addons to the whole client experience (like buttons to change the tilesets and other cool things)</li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>A much bigger project than I first imagined!</p>

<p>I knew it wasn‚Äôt going to be as simple as my little test-trial on my windows machine, but it turned having a much steeper learning curve than I expected.</p>

<p>I ended up learning a lot about Linux command line (as messing with the game files was more of a hassle then you‚Äôd imagine), a tiny bit more about Lua scripting (and how easy it was to get the ‚ÄúPause game script‚Äù to work, even though it was extremely useless in the end) and ended up with a very easy to use Dwarf Fortress server I can play in whenever I feel like.</p>

<p>One thing I‚Äôd like to add in here is that in these projects where information on the subject being worked on is very scarce (you aren‚Äôt going to find much more than 10 pages on the whole web talking about DFPlex, and though info on DFHack scripts is much more available, its still hard to parse through), ChatGPT is deceptively useful. 
It gets stuff wrong a lot of the time, but the understanding it has over the general principles of use on the subject allow you to just ‚Äútrial and error‚Äù scripts and command into life.</p>

<p>Genuinely hope to get more of these projects going as time goes by. Having this now set up on my Proxmox server makes me genuinely happy, and hopefully you could learn something with me (or at least laugh at some of my <em>not-great</em> decisions along the way ^^ )</p>


      </div>
    </main>
  </div>
</body>
</html>